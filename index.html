<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RPG ë¡œê·¸ ë¶ - LEON ë§ˆìŠ¤í„° ì—ë””ì…˜ V10.4</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2001@1.1/DungGeunMo.woff');

        :root {
            --main-brown: #3e2723;
            --hp-color: #ff5252;
            --mp-color: #2196f3;
            --exp-color: #ffd740;
            --gold-color: #ff8f00;
            --mint-color: #26c6da;
            --danger-color: #d32f2f;
        }

        body { transition: background-color 1s ease; font-family: 'DungGeunMo', sans-serif; margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; }
        
        .theme-rookie { background-color: #f4f7f6; }
        .theme-apprentice { background-color: #e8f5e9; }
        .theme-veteran { background-color: #fff3e0; }
        .theme-legend { background-color: #f3e5f5; }

        .container { width: 100%; max-width: 450px; position: relative; }

        .card {
            background: white; border: 3px solid var(--main-brown);
            padding: 15px; border-radius: 12px; margin-bottom: 12px;
            box-shadow: 6px 6px 0px rgba(0,0,0,0.1);
        }

        .profile-header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 10px; border-bottom: 2px dashed #ddd; padding-bottom: 8px; }
        .lv-info { font-size: 1.3rem; font-weight: bold; }
        .job-title { font-size: 0.85rem; color: #795548; display: block; }
        
        .status-icon { font-size: 1rem; margin-left: 3px; vertical-align: middle; }
        .alert-icon { font-size: 1.1rem; color: var(--danger-color); font-weight: bold; animation: blink 1s infinite; margin-left: 5px; }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }

        .status-text { font-size: 0.75rem; font-weight: bold; margin-left: 5px; }
        .hp-text { color: var(--hp-color); }
        .mp-text { color: var(--mp-color); }

        .bar-label { display: flex; justify-content: space-between; font-size: 0.8rem; margin-top: 8px; align-items: center; }
        .bar-container { width: 100%; height: 20px; background: #eee; border: 2px solid var(--main-brown); border-radius: 10px; margin: 4px 0; overflow: hidden; }
        .bar-fill { height: 100%; transition: width 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .hp-fill { background-color: var(--hp-color); }
        .mp-fill { background-color: var(--mp-color); }
        .exp-fill { background-color: var(--exp-color); }

        .control-group { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin: 15px 0; }
        .control-box { background: #fdfdfd; border: 2px solid var(--main-brown); padding: 8px; border-radius: 8px; font-size: 0.75rem; }
        .control-box strong { display: block; margin-bottom: 5px; color: var(--main-brown); }
        .control-box input { font-family: 'DungGeunMo'; width: 100%; box-sizing: border-box; margin-bottom: 5px; padding: 4px; border: 1px solid #ccc; border-radius: 4px; font-size: 0.7rem; }
        
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 4px; }
        .btn-full { grid-column: span 2; background: #f0f0f0 !important; font-weight: bold; }
        
        .chart-container { width: 100%; height: 220px; margin: 5px 0; }

        .stat-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 6px; background: #fafafa; padding: 10px; border-radius: 8px; border: 1px solid #ddd; }
        .stat-item { text-align: left; font-size: 0.65rem; font-weight: bold; background: white; padding: 8px; border: 1px solid #eee; border-radius: 4px; display: flex; justify-content: space-between; align-items: center; }
        .stat-item input { width: 45px; text-align: center; border: 2px solid var(--main-brown); border-radius: 4px; font-family: 'DungGeunMo'; font-size: 0.8rem; padding: 2px; }

        .grid-layout { display: grid; grid-template-columns: 1.2fr 1fr; gap: 10px; margin-bottom: 10px; }
        .section-title { font-size: 0.9rem; margin: 10px 0 5px 0; font-weight: bold; display: flex; align-items: center; justify-content: space-between; }
        
        .toggle-btn-group { display: flex; gap: 3px; }
        .t-btn { font-family: 'DungGeunMo'; font-size: 0.6rem; padding: 2px 5px; cursor: pointer; border: 1px solid #ccc; border-radius: 3px; background: #f0f0f0; }
        .t-btn.active-b { background: #b2ebf2; border-color: var(--mint-color); font-weight: bold; }
        .t-btn.active-d { background: #ffcdd2; border-color: #e57373; font-weight: bold; }

        .quest-list { background: #fff; border: 2px solid var(--main-brown); padding: 10px; border-radius: 10px; min-height: 140px; }
        .quest-item { display: flex; align-items: center; gap: 8px; font-size: 0.8rem; padding: 3px 0; }
        
        .buff-box { background: #fff; border: 3px solid var(--mint-color); padding: 10px; border-radius: 10px; font-size: 0.75rem; color: #333; display: flex; flex-direction: column; gap: 4px; }
        .buff-box input { border: none; border-bottom: 1px solid #ddd; font-family: 'DungGeunMo'; font-size: 0.7rem; width: 100%; padding: 2px 0; background: transparent; }
        .buff-box input:focus { outline: none; border-bottom: 1px solid var(--mint-color); }
        .buff-label { color: #00838f; font-weight: bold; }

        .special-box { background: #f3e5f5; border: 2px solid #a333c8; padding: 10px; border-radius: 10px; display: flex; gap: 5px; }
        .special-box input { flex: 1; font-family: 'DungGeunMo'; padding: 5px; border: 1px solid #a333c8; border-radius: 4px; }
        .special-btn { background: #a333c8; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-family: 'DungGeunMo'; font-size: 0.75rem; }
        
        button { font-family: 'DungGeunMo'; cursor: pointer; border: 2px solid var(--main-brown); background: white; padding: 5px; border-radius: 4px; font-size: 0.7rem; }

        .log-area { background: #1a1a1a; padding: 10px; border-radius: 8px; height: 160px; overflow-y: auto; font-size: 0.75rem; line-height: 1.5; border: 2px solid var(--main-brown); margin-top: 5px; }
        .log-pos { color: #4caf50; }
        .log-neg { color: #ff5252; font-weight: bold; }
        .log-special { color: #d1a3ff; font-weight: bold; }
        .log-user { color: #64b5f6; } 

        .user-log-box { display: flex; gap: 5px; margin-top: 8px; width: 100%; }
        .user-log-box input { flex: 1; font-family: 'DungGeunMo'; padding: 8px; border: 2px solid #2196f3; border-radius: 6px; font-size: 0.8rem; }
        .user-log-btn { background: #2196f3; color: white; border: none; padding: 0 15px; border-radius: 6px; cursor: pointer; font-family: 'DungGeunMo'; }

        .footer-btns { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; padding: 15px 0; width: 100%; }
        .reset-btn { background: none; border: 1px solid #ccc; color: #888; padding: 5px; font-size: 0.65rem; border-radius: 4px; cursor: pointer; }

        /* ë ˆë²¨ì—… íš¨ê³¼ ìŠ¤íƒ€ì¼ */
        @keyframes levelUpPop {
            0% { transform: scale(0.5); opacity: 0; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        .levelup-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 9999;
        }
        .levelup-card {
            background: white; border: 5px solid var(--exp-color);
            padding: 30px; border-radius: 20px; text-align: center;
            animation: levelUpPop 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
    </style>
</head>
<body class="theme-rookie">

<div class="container">
    <div class="card">
        <div class="profile-header">
            <div class="lv-info">
                <span class="job-title" id="job-title">ëª¨í—˜ê°€</span>
                Lv.<span id="lv-val">1</span> LEON 
                <span id="name-buff" class="status-icon" style="display:none">âœ¨</span>
                <span id="name-debuff" class="status-icon" style="display:none">ğŸ’¤</span>
                <span id="name-alert" class="alert-icon" style="display:none">â—</span>
            </div>
            <span id="gold-val" style="color:var(--gold-color); font-size: 1.1rem;">0 G</span>
        </div>
        
        <div class="bar-label"><span>â¤ï¸ HP <span id="hp-status" class="status-text hp-text">[ê³„ì‚°ì¤‘]</span></span><span id="hp-num" style="font-size: 0.7rem;">70/100</span></div>
        <div class="bar-container"><div id="hp-bar" class="bar-fill hp-fill"></div></div>
        
        <div class="bar-label"><span>ğŸ’§ MP <span id="mp-status" class="status-text mp-text">[ê³„ì‚°ì¤‘]</span></span><span id="mp-num" style="font-size: 0.7rem;">70/100</span></div>
        <div class="bar-container"><div id="mp-bar" class="bar-fill mp-fill"></div></div>
        
        <div class="bar-label"><span>â­ EXP</span></div>
        <div class="bar-container"><div id="exp-bar" class="bar-fill exp-fill"></div></div>

        <div class="control-group">
            <div class="control-box">
                <strong>[ìƒíƒœ ì¡°ì ˆ]</strong>
                <input type="text" id="status-reason" placeholder="ë³€í™” ì‚¬ìœ ">
                <div class="btn-grid">
                    <button onclick="updateStatus('hp', 10)">H+10</button><button onclick="updateStatus('hp', -10)">H-10</button>
                    <button onclick="updateStatus('mp', 10)">M+10</button><button onclick="updateStatus('mp', -10)">M-10</button>
                    <button class="btn-full" onclick="promptStatus('hp')">H+@</button>
                    <button class="btn-full" onclick="promptStatus('mp')">M+@</button>
                </div>
            </div>
            <div class="control-box">
                <strong>[ì„±ì¥ ê´€ë¦¬]</strong>
                <input type="text" id="exp-reason" placeholder="ì´ë²¤íŠ¸ ì‚¬ìœ ">
                <div class="btn-grid">
                    <button onclick="updateExp(50)">E+50</button><button onclick="updateExp(20)">E+20</button>
                    <button onclick="updateExp(10)">E+10</button><button onclick="updateGold()">Gold</button>
                    <button class="btn-full" onclick="promptExp()">E+@</button>
                </div>
            </div>
        </div>

        <div class="chart-container"><canvas id="statChart"></canvas></div>
        <div class="stat-grid">
            <div class="stat-item">ğŸ’ª STR<input type="number" id="in-str" onchange="changeStat('str', this.value)"></div>
            <div class="stat-item">ğŸ§  INT<input type="number" id="in-int" onchange="changeStat('int', this.value)"></div>
            <div class="stat-item">ğŸƒ DEX<input type="number" id="in-dex" onchange="changeStat('dex', this.value)"></div>
            <div class="stat-item">ğŸ¨ SENSE<input type="number" id="in-sense" onchange="changeStat('sense', this.value)"></div>
            <div class="stat-item">ğŸ›¡ï¸ WILL<input type="number" id="in-will" onchange="changeStat('will', this.value)"></div>
            <div class="stat-item">ğŸ€ LUK<input type="number" id="in-luk" onchange="changeStat('luk', this.value)"></div>
        </div>
    </div>

    <div class="grid-layout">
        <div>
            <div class="section-title">ğŸ›¡ï¸ í€˜ìŠ¤íŠ¸(+30)</div>
            <div class="quest-list" id="quest-container"></div>
        </div>
        <div>
            <div class="section-title">âœ¨ ë²„í”„
                <div class="toggle-btn-group">
                    <button id="btn-buff" class="t-btn" onclick="toggleStatus('buff')">ë²„í”„</button>
                    <button id="btn-debuff" class="t-btn" onclick="toggleStatus('debuff')">ë””ë²„í”„</button>
                </div>
            </div>
            <div class="buff-box">
                <div><span class="buff-label">> ë‹¨ê³„ :</span> <input type="text" id="buff-lv" onchange="saveBuff()"></div>
                <div><span class="buff-label">> ì•„ì´í…œ :</span> <input type="text" id="buff-item" onchange="saveBuff()"></div>
                <input type="text" id="buff-c1" placeholder="1ì¤„" onchange="saveBuff()"><input type="text" id="buff-c2" placeholder="2ì¤„" onchange="saveBuff()"><input type="text" id="buff-c3" placeholder="3ì¤„" onchange="saveBuff()">
            </div>
        </div>
    </div>

    <div class="section-title">ğŸ”® ìŠ¤í˜ì…œ ì´ë²¤íŠ¸ (+100 EXP)</div>
    <div class="special-box"><input type="text" id="special-input" placeholder="íŠ¹ë³„í•œ ì„±ì·¨ ê¸°ë¡"><button class="special-btn" onclick="addSpecialEvent()">ê¸°ë¡</button></div>

    <div class="section-title">ğŸ“œ íˆìŠ¤í† ë¦¬</div>
    <div class="log-area" id="log-list"></div>
    <div class="user-log-box"><input type="text" id="user-event-input" placeholder="ì§ì ‘ ê¸°ë¡ (íŒŒë€ìƒ‰)"><button class="user-log-btn" onclick="addUserEvent()">ê¸°ë¡</button></div>

    <div class="footer-btns">
        <button class="reset-btn" onclick="resetLevel()">LV ì´ˆê¸°í™”</button>
        <button class="reset-btn" onclick="resetSoft()">ìŠ¤íƒ¯ ì´ˆê¸°í™”</button>
        <button class="reset-btn" onclick="resetHistoryOnly()">ë¡œê·¸ ì‚­ì œ</button>
    </div>
</div>

<script>
    const QUESTS = ['ğŸŒ… 6ì‹œ ë¡œê·¸ì¸', 'ğŸƒ ìˆ˜ë ¨ ì™„ë£Œ', 'ğŸ“– ë…ì„œ 30ë¶„', 'ğŸ’° ê³¨ë“œ ì‚¬ìˆ˜', 'ğŸ—£ï¸ ì™¸êµ­ì–´ ìŠµë“'];
    const STORAGE_KEY = 'rpgDiaryLeonV10_Final';
    
    let charData = { 
        lv: 1, hp: 70, mp: 70, exp: 0, gold: 0, 
        stats: { str: 10, int: 10, dex: 10, sense: 10, will: 10, luk: 10 }, 
        logs: [], lastQuestDate: "", completedQuests: [],
        dailyBuff: { lv: '', item: '', c1: '', c2: '', c3: '' },
        isBuffActive: false, isDebuffActive: false, wasAlertActive: false
    };
    
    let myChart;

    window.onload = () => {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) charData = JSON.parse(saved);
        checkDailyReset(); initChart(); render();
    };

    function checkDailyReset() {
        const today = new Date().toLocaleDateString();
        if (charData.lastQuestDate !== today) {
            charData.lastQuestDate = today; charData.completedQuests = [];
            addLog("ìƒˆë¡œìš´ ë‚ ì˜ ì‹œì‘!", "log-pos");
        }
        drawQuests();
    }

    function toggleStatus(type) {
        if(type === 'buff') { charData.isBuffActive = !charData.isBuffActive; addLog(`ë²„í”„ ${charData.isBuffActive ? 'í™œì„±' : 'í•´ì œ'}`, 'log-pos'); } 
        else { charData.isDebuffActive = !charData.isDebuffActive; addLog(`ë””ë²„í”„ ${charData.isDebuffActive ? 'í™œì„±' : 'í•´ì œ'}`, 'log-neg'); }
        render();
    }

    function saveBuff() {
        charData.dailyBuff = {
            lv: document.getElementById('buff-lv').value,
            item: document.getElementById('buff-item').value,
            c1: document.getElementById('buff-c1').value,
            c2: document.getElementById('buff-c2').value,
            c3: document.getElementById('buff-c3').value
        };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(charData));
    }

    function drawQuests() {
        const container = document.getElementById('quest-container');
        container.innerHTML = QUESTS.map(q => `<label class="quest-item"><input type="checkbox" ${charData.completedQuests.includes(q) ? 'checked' : ''} onchange="toggleQuest('${q}', this)"> ${q}</label>`).join('');
    }

    function render() {
        const hpSt = document.getElementById('hp-status');
        if(charData.hp >= 80) hpSt.innerText = "[í™œë ¥ ë„˜ì¹¨]";
        else if(charData.hp >= 40) hpSt.innerText = "[ë³´í†µ]";
        else if(charData.hp >= 20) hpSt.innerText = "[í”¼ê³¤í•¨]";
        else hpSt.innerText = "[íƒˆì§„]";

        const mpSt = document.getElementById('mp-status');
        if(charData.mp >= 80) mpSt.innerText = "[ì •ì‹  ë§‘ìŒ]";
        else if(charData.mp >= 40) mpSt.innerText = "[ì•ˆì •]";
        else if(charData.mp >= 20) mpSt.innerText = "[ì£¼ì˜ ì‚°ë§Œ]";
        else mpSt.innerText = "[í˜¼ë€ìŠ¤ëŸ¬ì›€]";

        const isCurrentlyDangerous = charData.hp <= 30 || charData.mp <= 30;
        if (isCurrentlyDangerous && !charData.wasAlertActive) {
            addLog("âš ï¸ ì‹œìŠ¤í…œ ê²½ë³´: ìˆ˜ì¹˜ ìœ„í—˜! íšŒë³µì´ í•„ìš”í•©ë‹ˆë‹¤.", "log-neg");
            charData.wasAlertActive = true;
        } else if (!isCurrentlyDangerous && charData.wasAlertActive) {
            addLog("âœ… ìˆ˜ì¹˜ê°€ ì •ìƒ ë²”ìœ„ë¡œ íšŒë³µë˜ì—ˆìŠµë‹ˆë‹¤.", "log-pos");
            charData.wasAlertActive = false;
        }

        localStorage.setItem(STORAGE_KEY, JSON.stringify(charData));
        document.getElementById('lv-val').innerText = charData.lv;
        document.getElementById('job-title').innerText = getJobTitle(charData.lv);
        document.getElementById('gold-val').innerText = charData.gold.toLocaleString() + " G";
        
        document.getElementById('name-buff').style.display = charData.isBuffActive ? 'inline' : 'none';
        document.getElementById('name-debuff').style.display = charData.isDebuffActive ? 'inline' : 'none';
        document.getElementById('name-alert').style.display = isCurrentlyDangerous ? 'inline' : 'none';

        document.getElementById('hp-bar').style.width = charData.hp + "%";
        document.getElementById('mp-bar').style.width = charData.mp + "%";
        document.getElementById('exp-bar').style.width = (charData.exp % 100) + "%";
        document.getElementById('hp-num').innerText = `${charData.hp}/100`;
        document.getElementById('mp-num').innerText = `${charData.mp}/100`;

        document.getElementById('btn-buff').className = charData.isBuffActive ? 't-btn active-b' : 't-btn';
        document.getElementById('btn-debuff').className = charData.isDebuffActive ? 't-btn active-d' : 't-btn';

        const body = document.body;
        body.className = charData.lv >= 35 ? 'theme-legend' : (charData.lv >= 20 ? 'theme-veteran' : (charData.lv >= 10 ? 'theme-apprentice' : 'theme-rookie'));

        for (let s in charData.stats) document.getElementById(`in-${s}`).value = charData.stats[s];
        document.getElementById('log-list').innerHTML = charData.logs.map(l => `<div class="${l.colorClass}">> ${l.time} | ${l.msg}</div>`).reverse().join('');
        myChart.data.datasets[0].data = Object.values(charData.stats);
        myChart.update();
    }

    function initChart() {
        const ctx = document.getElementById('statChart').getContext('2d');
        myChart = new Chart(ctx, {
            type: 'radar',
            data: {
                labels: ['STR', 'INT', 'DEX', 'SENSE', 'WILL', 'LUK'],
                datasets: [{ data: Object.values(charData.stats), backgroundColor: 'rgba(62, 39, 35, 0.4)', borderColor: 'rgba(62, 39, 35, 1)', borderWidth: 2, pointRadius: 3 }]
            },
            options: { scales: { r: { min: 0, max: 100, ticks: { display: false } } }, plugins: { legend: { display: false } } }
        });
    }

    function getJobTitle(lv) {
        if (lv >= 50) return "ğŸ‘‘ ì „ì„¤ì˜ ìˆ˜í˜¸ì";
        if (lv >= 35) return "ğŸ›¡ï¸ ì„±ê¸°ì‚¬";
        if (lv >= 20) return "ğŸ¹ ë² í…Œë‘ ìš©ì‚¬";
        if (lv >= 10) return "âœ¨ ìˆ™ë ¨ëœ í›ˆë ¨ìƒ";
        return "ğŸŒ± ì´ˆë³´ ëª¨í—˜ê°€";
    }

    function addLog(msg, colorClass = 'log-pos') {
        const time = new Date().toLocaleTimeString('ko-KR', { hour12: false, hour: '2-digit', minute: '2-digit' });
        charData.logs.push({ time, msg, colorClass });
        if (charData.logs.length > 50) charData.logs.shift();
    }

    function toggleQuest(name, cb) {
        if (cb.checked) { charData.completedQuests.push(name); updateExp(30, `í€˜ìŠ¤íŠ¸: ${name}`); } 
        else { charData.completedQuests = charData.completedQuests.filter(q => q !== name); addLog(`ì·¨ì†Œ: ${name}`, 'log-neg'); }
        render();
    }

    function updateStatus(type, amt, reasonParam) {
        const reason = reasonParam || document.getElementById('status-reason').value || "ì¼ë°˜ í™œë™";
        if (type === 'hp') charData.hp = Math.max(0, Math.min(100, charData.hp + amt));
        else charData.mp = Math.max(0, Math.min(100, charData.mp + amt));
        addLog(`${type.toUpperCase()} ${amt>0?'+':''}${amt} (${reason})`, amt < 0 ? 'log-neg' : 'log-pos');
        document.getElementById('status-reason').value = "";
        render();
    }

    function promptStatus(type) {
        const val = parseInt(prompt(`${type.toUpperCase()} ë³€í™”ëŸ‰ì„ ì…ë ¥í•˜ì„¸ìš”:`));
        if(!isNaN(val)) {
            const reason = prompt("ë³€í™” ì‚¬ìœ ë¥¼ ì…ë ¥í•˜ì„¸ìš”:", "ì»¤ìŠ¤í…€ ì¡°ì ˆ") || "ì»¤ìŠ¤í…€ ì¡°ì ˆ";
            updateStatus(type, val, reason);
        }
    }

    function updateExp(amt, reasonParam) {
        const reason = reasonParam || document.getElementById('exp-reason').value || "ì„±ì¥";
        const oldLv = Math.floor(charData.exp / 100) + 1;
        charData.exp += amt;
        const newLv = Math.floor(charData.exp / 100) + 1;
        addLog(`âœ¨ EXP +${amt} (${reason})`, 'log-pos');
        if (newLv > oldLv) { 
            charData.lv = newLv; 
            addLog(`ğŸŠ LEVEL UP! Lv.${newLv}`, 'log-pos');
            showLevelUpEffect(newLv);
        }
        document.getElementById('exp-reason').value = "";
        render();
    }

    function showLevelUpEffect(lv) {
        const overlay = document.createElement('div');
        overlay.className = 'levelup-overlay';
        overlay.innerHTML = `
            <div class="levelup-card">
                <div style="font-size: 3rem;">ğŸŠ</div>
                <div style="color: #3e2723; margin: 10px 0; font-size: 1.5rem;">LEVEL UP!</div>
                <div style="font-size: 2.5rem; color: #ff8f00;">Lv.${lv}</div>
                <button onclick="this.parentElement.parentElement.remove()" style="margin-top: 20px; padding: 10px 20px; background: var(--exp-color); border: 2px solid #3e2723; cursor: pointer; font-family: 'DungGeunMo';">í™•ì¸</button>
            </div>
        `;
        document.body.appendChild(overlay);
        setTimeout(() => { if(overlay.parentNode) overlay.remove(); }, 4000);
    }

    function promptExp() {
        const val = parseInt(prompt(`EXP ì¦ê°€ëŸ‰ì„ ì…ë ¥í•˜ì„¸ìš”:`));
        if(!isNaN(val)) {
            const reason = prompt("ì„±ì¥ ì‚¬ìœ ë¥¼ ì…ë ¥í•˜ì„¸ìš”:", "ì»¤ìŠ¤í…€ ì„±ì¥") || "ì»¤ìŠ¤í…€ ì„±ì¥";
            updateExp(val, reason);
        }
    }

    function changeStat(statName, newValue) {
        const oldVal = charData.stats[statName];
        const newVal = parseInt(newValue) || 0;
        const diff = newVal - oldVal;
        if (diff === 0) return;
        const reason = prompt(`${statName.toUpperCase()} ë³€ê²½ ì‚¬ìœ :`, "ìˆ˜ë ¨");
        if (reason) { charData.stats[statName] = newVal; addLog(`${statName.toUpperCase()} ${diff>0?'+':''}${diff} (${reason})`, diff < 0 ? 'log-neg' : 'log-pos'); } 
        else document.getElementById(`in-${statName}`).value = oldVal;
        render();
    }

    function updateGold() {
        const reason = document.getElementById('exp-reason').value || "ë³´ìƒ";
        const amt = parseInt(prompt("ê³¨ë“œ ë³€í™”ëŸ‰:"));
        if (!isNaN(amt)) { charData.gold += amt; addLog(`ğŸ’° GOLD ${amt>0?'+':''}${amt} (${reason})`, amt < 0 ? 'log-neg' : 'log-pos'); render(); }
    }

    function addSpecialEvent() {
        const input = document.getElementById('special-input');
        if (!input.value) return;
        addLog(`â˜… SPECIAL: ${input.value} (+100 EXP)`, 'log-special');
        updateExp(100, "ìŠ¤í˜ì…œ ì„±ì·¨");
        input.value = ""; render();
    }

    function addUserEvent() {
        const input = document.getElementById('user-event-input');
        if (!input.value) return;
        addLog(`[ê¸°ë¡] ${input.value}`, 'log-user');
        input.value = ""; render();
    }

    function resetLevel() { if(confirm("LV ì´ˆê¸°í™”?")) { charData.lv = 1; charData.exp = 0; render(); } }
    function resetSoft() { if(confirm("ë°ì´í„° ì´ˆê¸°í™”?")) { charData.hp = 70; charData.mp = 70; charData.gold = 0; charData.stats = { str: 10, int: 10, dex: 10, sense: 10, will: 10, luk: 10 }; render(); } }
    function resetHistoryOnly() { if(confirm("ë¡œê·¸ ì‚­ì œ?")) { charData.logs = []; render(); } }
</script>

</body>
</html>


