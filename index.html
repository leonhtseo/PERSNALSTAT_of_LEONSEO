<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RPG ë¡œê·¸ ë¶ - ë§ˆìŠ¤í„° ë²„ì „</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2001@1.1/DungGeunMo.woff');

        :root {
            --main-brown: #3e2723;
            --hp-color: #ff5252;
            --mp-color: #2196f3;
            --exp-color: #ffd740;
            --gold-color: #ff8f00;
        }

        body { transition: background-color 1s ease; font-family: 'DungGeunMo', sans-serif; margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; }
        
        .theme-rookie { background-color: #f4f7f6; }
        .theme-apprentice { background-color: #e8f5e9; }
        .theme-veteran { background-color: #fff3e0; }
        .theme-legend { background-color: #f3e5f5; }

        .container { width: 100%; max-width: 450px; position: relative; }

        .card {
            background: white; border: 3px solid var(--main-brown);
            padding: 15px; border-radius: 12px; margin-bottom: 12px;
            box-shadow: 6px 6px 0px rgba(0,0,0,0.1);
        }

        .profile-header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 10px; border-bottom: 2px dashed #ddd; padding-bottom: 8px; }
        .lv-info { font-size: 1.3rem; font-weight: bold; }
        .job-title { font-size: 0.85rem; color: #795548; display: block; }

        .bar-label { display: flex; justify-content: space-between; font-size: 0.8rem; margin-top: 8px; }
        .bar-container { width: 100%; height: 20px; background: #eee; border: 2px solid var(--main-brown); border-radius: 10px; margin: 4px 0; overflow: hidden; }
        .bar-fill { height: 100%; transition: width 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .hp-fill { background-color: var(--hp-color); }
        .mp-fill { background-color: var(--mp-color); }
        .exp-fill { background-color: var(--exp-color); }

        .chart-container { width: 100%; height: 240px; margin: 5px 0; }

        .stat-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 6px; background: #fafafa; padding: 10px; border-radius: 8px; border: 1px solid #ddd; }
        .stat-item { text-align: left; font-size: 0.65rem; font-weight: bold; background: white; padding: 5px; border: 1px solid #eee; border-radius: 4px; }
        .stat-item input { width: 40px; float: right; text-align: center; border: 1px solid var(--main-brown); border-radius: 4px; font-family: 'DungGeunMo'; }

        .section-title { font-size: 0.9rem; margin: 10px 0 5px 0; font-weight: bold; }
        .quest-list { background: #fff; border: 2px solid var(--main-brown); padding: 10px; border-radius: 10px; margin-bottom: 10px; }
        .quest-item { display: flex; align-items: center; gap: 8px; font-size: 0.85rem; padding: 3px 0; }
        
        .special-box { background: #f3e5f5; border: 2px solid #a333c8; padding: 10px; border-radius: 10px; display: flex; gap: 5px; }
        .special-box input { flex: 1; font-family: 'DungGeunMo'; padding: 5px; border: 1px solid #a333c8; border-radius: 4px; }
        .special-btn { background: #a333c8; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-family: 'DungGeunMo'; font-size: 0.75rem; }

        .control-group { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px;}
        .control-box { background: #fff; border: 2px solid var(--main-brown); padding: 10px; border-radius: 8px; font-size: 0.8rem; }
        .control-box input { font-family: 'DungGeunMo'; width: 100%; box-sizing: border-box; margin-bottom: 5px; padding: 5px; border: 1px solid #ccc; border-radius: 4px; font-size: 0.75rem; }
        
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 4px; }
        button { font-family: 'DungGeunMo'; cursor: pointer; border: 2px solid var(--main-brown); background: white; padding: 5px; border-radius: 4px; font-size: 0.7rem; }

        .log-area { background: #1a1a1a; padding: 10px; border-radius: 8px; height: 160px; overflow-y: auto; font-size: 0.75rem; line-height: 1.5; border: 2px solid var(--main-brown); margin-top: 5px; }
        .log-pos { color: #4caf50; }
        .log-neg { color: #ff5252; font-weight: bold; }
        .log-special { color: #d1a3ff; font-weight: bold; }
        .log-user { color: #64b5f6; } /* íŒŒë€ìƒ‰ ë¡œê·¸ */

        .user-log-box { display: flex; gap: 5px; margin-top: 8px; }
        .user-log-box input { flex: 1; font-family: 'DungGeunMo'; padding: 8px; border: 2px solid #2196f3; border-radius: 6px; font-size: 0.8rem; }
        .user-log-btn { background: #2196f3; color: white; border: none; padding: 0 15px; border-radius: 6px; cursor: pointer; font-family: 'DungGeunMo'; }

        .sparkle { position: absolute; width: 6px; height: 6px; background: gold; border-radius: 50%; pointer-events: none; z-index: 1000; animation: move-sparkle 1s ease-out forwards; }
        @keyframes move-sparkle { 0% { transform: translate(0, 0) scale(1); opacity: 1; } 100% { transform: translate(var(--x), var(--y)) scale(0); opacity: 0; } }

        .footer-btns { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; padding: 15px 0; width: 100%; }
        .reset-btn { background: none; border: 1px solid #ccc; color: #888; padding: 5px; font-size: 0.65rem; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body class="theme-rookie">

<div class="container" id="main-container">
    <div class="card">
        <div class="profile-header">
            <div class="lv-info"><span class="job-title" id="job-title">ì´ˆë³´ ëª¨í—˜ê°€</span>Lv.<span id="lv-val">1</span> USER</div>
            <span id="gold-val" style="color:var(--gold-color); font-size: 1.1rem;">0 G</span>
        </div>
        
        <div class="bar-label"><span>â¤ï¸ HP</span><span id="hp-status">-</span></div>
        <div class="bar-container"><div id="hp-bar" class="bar-fill hp-fill"></div></div>
        
        <div class="bar-label"><span>ğŸ’§ MP</span><span id="mp-status">-</span></div>
        <div class="bar-container"><div id="mp-bar" class="bar-fill mp-fill"></div></div>
        
        <div class="bar-label"><span>â­ EXP</span></div>
        <div class="bar-container"><div id="exp-bar" class="bar-fill exp-fill"></div></div>

        <div class="chart-container"><canvas id="statChart"></canvas></div>

        <div class="stat-grid">
            <div class="stat-item">ğŸ’ª ê±´ê°•/ì²´ë ¥<input type="number" id="in-str" onchange="changeStat('str', this.value)"></div>
            <div class="stat-item">ğŸ§  ì§€ì„±/ì„±ì¥<input type="number" id="in-int" onchange="changeStat('int', this.value)"></div>
            <div class="stat-item">ğŸƒ ë£¨í‹´/ì‹¤í–‰ë ¥<input type="number" id="in-dex" onchange="changeStat('dex', this.value)"></div>
            <div class="stat-item">ğŸ¨ ì·¨í–¥/ê°ì„±<input type="number" id="in-sense" onchange="changeStat('sense', this.value)"></div>
            <div class="stat-item">ğŸ›¡ï¸ ë©˜íƒˆ/ì˜ì§€<input type="number" id="in-will" onchange="changeStat('will', this.value)"></div>
            <div class="stat-item">ğŸ€ í–‰ë³µ/ìš´<input type="number" id="in-luk" onchange="changeStat('luk', this.value)"></div>
        </div>
    </div>

    <div class="section-title">ğŸ›¡ï¸ ì¼ì¼ í€˜ìŠ¤íŠ¸ (+30 EXP)</div>
    <div class="quest-list" id="quest-container">
        </div>

    <div class="section-title">ğŸ”® ìŠ¤í˜ì…œ ì´ë²¤íŠ¸ (+100 EXP)</div>
    <div class="special-box">
        <input type="text" id="special-input" placeholder="íŠ¹ë³„í•œ ì„±ì·¨ ê¸°ë¡">
        <button class="special-btn" onclick="addSpecialEvent()">ê¸°ë¡</button>
    </div>

    <div class="control-group">
        <div class="control-box">
            <strong>[ìƒíƒœ ì¡°ì ˆ]</strong>
            <input type="text" id="status-reason" placeholder="ë³€í™” ì‚¬ìœ ">
            <div class="btn-grid">
                <button onclick="updateStatus('hp', 10)">H+10</button><button onclick="updateStatus('hp', -10)">H-10</button>
                <button onclick="updateStatus('mp', 10)">M+10</button><button onclick="updateStatus('mp', -10)">M-10</button>
            </div>
        </div>
        <div class="control-box">
            <strong>[ì„±ì¥ ê´€ë¦¬]</strong>
            <input type="text" id="exp-reason" placeholder="ì´ë²¤íŠ¸ ì‚¬ìœ ">
            <div class="btn-grid">
                <button onclick="updateExp(50)">E+50</button><button onclick="updateExp(20)">E+20</button>
                <button onclick="updateExp(10)">E+10</button><button onclick="updateGold()">Gold</button>
            </div>
        </div>
    </div>

    <div class="section-title">ğŸ“œ íˆìŠ¤í† ë¦¬</div>
    <div class="log-area" id="log-list"></div>
    <div class="user-log-box">
        <input type="text" id="user-event-input" placeholder="ì—¬ê¸°ì— ì§ì ‘ íˆìŠ¤í† ë¦¬ë¥¼ ì ìœ¼ì„¸ìš”">
        <button class="user-log-btn" onclick="addUserEvent()">ê¸°ë¡</button>
    </div>

    <div class="footer-btns">
        <button class="reset-btn" onclick="resetLevel()">ë ˆë²¨ ì´ˆê¸°í™”</button>
        <button class="reset-btn" onclick="resetSoft()">ë°ì´í„° ì´ˆê¸°í™”</button>
        <button class="reset-btn" onclick="resetHistoryOnly()">ë¡œê·¸ë§Œ ì‚­ì œ</button>
    </div>
</div>

<script>
    const QUESTS = ['ğŸŒ… 6ì‹œ ë¡œê·¸ì¸', 'ğŸƒ ìˆ˜ë ¨ ì™„ë£Œ', 'ğŸ“– ë…ì„œ 30ë¶„', 'ğŸ’° ê³¨ë“œ ì‚¬ìˆ˜', 'ğŸ—£ï¸ ì™¸êµ­ì–´ ìŠµë“'];
    let charData = { 
        lv: 1, hp: 70, mp: 70, exp: 0, gold: 0, 
        stats: { str: 10, int: 10, dex: 10, sense: 10, will: 10, luk: 10 }, 
        logs: [],
        lastQuestDate: "",
        completedQuests: []
    };
    let myChart;

    window.onload = () => {
        const saved = localStorage.getItem('rpgDiaryV8');
        if (saved) charData = JSON.parse(saved);
        
        checkDailyReset();
        initChart();
        render();
    };

    // ìì • ì²´í¬ ë° í€˜ìŠ¤íŠ¸ ë¦¬ì…‹
    function checkDailyReset() {
        const today = new Date().toLocaleDateString();
        if (charData.lastQuestDate !== today) {
            charData.lastQuestDate = today;
            charData.completedQuests = [];
            addLog("ìƒˆë¡œìš´ ë‚ ì´ ë°ì•˜ìŠµë‹ˆë‹¤! í€˜ìŠ¤íŠ¸ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.", "log-pos");
        }
        drawQuests();
    }

    function drawQuests() {
        const container = document.getElementById('quest-container');
        container.innerHTML = QUESTS.map(q => `
            <label class="quest-item">
                <input type="checkbox" ${charData.completedQuests.includes(q) ? 'checked' : ''} onchange="toggleQuest('${q}', this)"> ${q}
            </label>
        `).join('');
    }

    function toggleQuest(name, cb) {
        if (cb.checked) {
            charData.completedQuests.push(name);
            updateExp(30, `í€˜ìŠ¤íŠ¸: ${name}`);
        } else {
            charData.completedQuests = charData.completedQuests.filter(q => q !== name);
            addLog(`í€˜ìŠ¤íŠ¸ ì·¨ì†Œ: ${name}`, 'log-neg');
        }
        render();
    }

    function initChart() {
        const ctx = document.getElementById('statChart').getContext('2d');
        myChart = new Chart(ctx, {
            type: 'radar',
            data: {
                labels: ['STR', 'INT', 'DEX', 'SENSE', 'WILL', 'LUK'],
                datasets: [{ data: Object.values(charData.stats), backgroundColor: 'rgba(62, 39, 35, 0.4)', borderColor: 'rgba(62, 39, 35, 1)', borderWidth: 2, pointRadius: 3 }]
            },
            options: { scales: { r: { min: 0, max: 100, ticks: { display: false } } }, plugins: { legend: { display: false } } }
        });
    }

    function render() {
        localStorage.setItem('rpgDiaryV8', JSON.stringify(charData));
        document.getElementById('lv-val').innerText = charData.lv;
        document.getElementById('job-title').innerText = getJobTitle(charData.lv);
        document.getElementById('gold-val').innerText = charData.gold.toLocaleString() + " G";
        document.getElementById('hp-bar').style.width = charData.hp + "%";
        document.getElementById('mp-bar').style.width = charData.mp + "%";
        document.getElementById('exp-bar').style.width = (charData.exp % 100) + "%";
        
        const body = document.body;
        body.className = charData.lv >= 35 ? 'theme-legend' : (charData.lv >= 20 ? 'theme-veteran' : (charData.lv >= 10 ? 'theme-apprentice' : 'theme-rookie'));

        for (let s in charData.stats) document.getElementById(`in-${s}`).value = charData.stats[s];
        document.getElementById('log-list').innerHTML = charData.logs.map(l => `<div class="${l.colorClass}">> ${l.time} | ${l.msg}</div>`).reverse().join('');
        myChart.data.datasets[0].data = Object.values(charData.stats);
        myChart.update();
    }

    function getJobTitle(lv) {
        if (lv >= 50) return "ğŸ‘‘ ì „ì„¤ì˜ ìˆ˜í˜¸ì";
        if (lv >= 35) return "ğŸ›¡ï¸ ì„±ê¸°ì‚¬";
        if (lv >= 20) return "ğŸ¹ ë² í…Œë‘ ìš©ì‚¬";
        if (lv >= 10) return "âœ¨ ìˆ™ë ¨ëœ í›ˆë ¨ìƒ";
        return "ğŸŒ± ì´ˆë³´ ëª¨í—˜ê°€";
    }

    function addLog(msg, colorClass = 'log-pos') {
        const time = new Date().toLocaleTimeString('ko-KR', { hour12: false, hour: '2-digit', minute: '2-digit' });
        charData.logs.push({ time, msg, colorClass });
        if (charData.logs.length > 50) charData.logs.shift();
    }

    // íŒŒë€ìƒ‰ ìœ ì € ì´ë²¤íŠ¸ ì¶”ê°€
    function addUserEvent() {
        const input = document.getElementById('user-event-input');
        if (!input.value) return;
        addLog(`[ì´ë²¤íŠ¸] ${input.value}`, 'log-user');
        input.value = "";
        render();
    }

    function addSpecialEvent() {
        const input = document.getElementById('special-input');
        if (!input.value) return;
        addLog(`â˜… SPECIAL: ${input.value} (+100 EXP)`, 'log-special');
        updateExp(100, "ìŠ¤í˜ì…œ ì„±ì·¨");
        input.value = "";
        render();
    }

    function updateStatus(type, amt) {
        const reason = document.getElementById('status-reason').value || "ì¼ë°˜ í™œë™";
        if (type === 'hp') charData.hp = Math.max(0, Math.min(100, charData.hp + amt));
        else charData.mp = Math.max(0, Math.min(100, charData.mp + amt));
        addLog(`${type.toUpperCase()} ${amt>0?'+':''}${amt} (${reason})`, amt < 0 ? 'log-neg' : 'log-pos');
        document.getElementById('status-reason').value = "";
        render();
    }

    function changeStat(statName, newValue) {
        const oldVal = charData.stats[statName];
        const newVal = parseInt(newValue) || 0;
        const diff = newVal - oldVal;
        if (diff === 0) return;
        const reason = prompt(`ë³€ê²½ ì‚¬ìœ :`, "ìˆ˜ë ¨");
        if (reason) {
            charData.stats[statName] = newVal;
            addLog(`${statName.toUpperCase()} ${diff>0?'+':''}${diff} (${reason})`, diff < 0 ? 'log-neg' : 'log-pos');
        } else document.getElementById(`in-${statName}`).value = oldVal;
        render();
    }

    function updateExp(amt, reasonParam) {
        const reason = reasonParam || document.getElementById('exp-reason').value || "ì„±ì¥";
        const oldLv = Math.floor(charData.exp / 100) + 1;
        charData.exp += amt;
        const newLv = Math.floor(charData.exp / 100) + 1;
        addLog(`âœ¨ EXP +${amt} (${reason})`, 'log-pos');
        if (newLv > oldLv) {
            charData.lv = newLv;
            addLog(`ğŸŠ LEVEL UP! Lv.${newLv}`, 'log-pos');
            createSparkle();
        }
        document.getElementById('exp-reason').value = "";
        render();
    }

    function createSparkle() {
        for (let i = 0; i < 30; i++) {
            const s = document.createElement('div');
            s.className = 'sparkle';
            s.style.setProperty('--x', `${(Math.random() - 0.5) * 300}px`);
            s.style.setProperty('--y', `${(Math.random() - 0.5) * 300}px`);
            s.style.left = '50%'; s.style.top = '20%';
            document.getElementById('main-container').appendChild(s);
            setTimeout(() => s.remove(), 1000);
        }
    }

    function updateGold() {
        const reason = document.getElementById('exp-reason').value || "ë³´ìƒ";
        const amt = parseInt(prompt("ê³¨ë“œ ë³€í™”ëŸ‰:"));
        if (!isNaN(amt)) { 
            charData.gold += amt; 
            addLog(`ğŸ’° GOLD ${amt>0?'+':''}${amt} (${reason})`, amt < 0 ? 'log-neg' : 'log-pos'); 
            document.getElementById('exp-reason').value = "";
            render(); 
        }
    }

    function resetLevel() { if(confirm("ë ˆë²¨/ê²½í—˜ì¹˜ë¥¼ ì´ˆê¸°í™”í• ê¹Œìš”?")) { charData.lv = 1; charData.exp = 0; render(); } }
    function resetSoft() { if(confirm("ìŠ¤íƒ¯/ì¬í™” ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í• ê¹Œìš”?")) { charData.hp = 70; charData.mp = 70; charData.gold = 0; charData.stats = { str: 10, int: 10, dex: 10, sense: 10, will: 10, luk: 10 }; render(); } }
    function resetHistoryOnly() { if(confirm("ë¡œê·¸ë¥¼ ëª¨ë‘ ì‚­ì œí• ê¹Œìš”?")) { charData.logs = []; render(); } }
</script>

</body>
</html>
